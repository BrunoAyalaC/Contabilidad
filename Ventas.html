<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ventas</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
        .container { max-width: 800px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 32px; }
        h1 { color: #9b59b6; }
        table { width: 100%; border-collapse: collapse; margin-top: 18px; background: #f6eaf6; }
        th, td { padding: 8px 12px; border: 1px solid #ddd; }
        th { background: #e1ccec; color: #2c3e50; }
        .actions button { margin-right: 6px; }
        .add-btn { background: #9b59b6; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        .add-btn:hover { background: #7d3c98; }
        .img-thumb { width: 48px; height: auto; }
        .stock-info { font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Login de Trabajador</h1>
        <label>Usuario:<br><input id='usuario' type='text' style='width:220px;'></label><br><br>
        <button class='add-btn' onclick='login()'>Ingresar</button>
    </div>
    <script>
    // Datos mock para ventas y almacén de medias
    let almacen = [
        {id:1, producto:'Media deportiva', talla:'M', color:'Negro', stock:80, imagen:'https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=48&q=80'},
        {id:2, producto:'Media casual', talla:'L', color:'Blanco', stock:170, imagen:'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?auto=format&fit=crop&w=48&q=80'}
    ];
    let ventas = [
        {
            id: 1,
            cliente: 'Bodega El Sol',
            producto: 'Media deportiva',
            talla: 'M',
            color: 'Negro',
            cantidad: 10,
            total: 50,
            pagado: 60,
            vuelto: 10,
            fecha: new Date('2025-08-09T09:15:00')
        },
        {
            id: 2,
            cliente: 'Zapatería Perú',
            producto: 'Media casual',
            talla: 'L',
            color: 'Blanco',
            cantidad: 20,
            total: 100,
            pagado: 100,
            vuelto: 0,
            fecha: new Date('2025-08-09T11:30:00')
        },
        {
            id: 3,
            cliente: 'Mercado Central',
            producto: 'Media deportiva',
            talla: 'S',
            color: 'Azul',
            cantidad: 5,
            total: 25,
            pagado: 30,
            vuelto: 5,
            fecha: new Date('2025-08-09T13:45:00')
        }
    ];

    // --- Login y apertura de caja ---
    let trabajador = null;
    let caja = null;

    function showLogin() {
        document.body.innerHTML = `
        <div class='container'>
            <h1>Login de Trabajador</h1>
            <label>Usuario:<br><input id='usuario' type='text' style='width:220px;'></label><br><br>
            <button class='add-btn' onclick='login()'>Ingresar</button>
        </div>
        `;
    }
    function login() {
        const usuario = document.getElementById('usuario').value.trim();
        if(!usuario) {
            alert('Ingrese usuario válido.');
            return;
        }
        trabajador = usuario;
        showAperturaCaja();
    }
    function showAperturaCaja() {
        document.body.innerHTML = `
        <div class='container'>
            <h1>Apertura de Caja</h1>
            <div><strong>Trabajador:</strong> ${trabajador}</div><br>
            <label>Monto de apertura de caja (S/):<br><input id='monto' type='number' min='0' step='0.01' style='width:120px;'></label><br><br>
            <button class='add-btn' onclick='aperturarCaja()'>Aperturar Caja</button>
        </div>
        `;
    }
    function aperturarCaja() {
        const monto = parseFloat(document.getElementById('monto').value);
        if(isNaN(monto) || monto < 0) {
            alert('Ingrese un monto válido.');
            return;
        }
        caja = monto;
        showVentas();
    }
    function showVentas() {
        // Filtrar ventas del día
        const hoy = new Date();
        const ventasHoy = ventas.filter(v => {
            if (!v.fecha) return false;
            return v.fecha.getDate() === hoy.getDate() && v.fecha.getMonth() === hoy.getMonth() && v.fecha.getFullYear() === hoy.getFullYear();
        });
        document.body.innerHTML = `
        <div class='container'>
            <h1>Gestión de Ventas</h1>
            <div style='margin-bottom:18px;'><strong>Trabajador:</strong> ${trabajador} &nbsp; | &nbsp; <strong>Caja inicial:</strong> S/ ${caja.toFixed(2)}</div>
            <button class='add-btn' onclick='addVenta()'>Agregar Venta</button>
            <h2>Ventas del Día (${hoy.toLocaleDateString()})</h2>
            <table> <thead> <tr>
                <th>ID</th><th>Cliente</th><th>Producto</th><th>Imagen</th><th>Talla</th><th>Color</th><th>Cantidad</th><th>Stock Disponible</th><th>Acciones</th>
            </tr></thead>
            <tbody id='ventasHoyBody'></tbody>
            </table>
            <hr style='margin:32px 0;'>
            <h2>Histórico de Ventas</h2>
            <table> <thead> <tr>
                <th>ID</th><th>Cliente</th><th>Producto</th><th>Imagen</th><th>Talla</th><th>Color</th><th>Cantidad</th><th>Stock Disponible</th><th>Acciones</th>
            </tr></thead>
            <tbody id='ventasBody'></tbody>
            </table>
            <hr style='margin:32px 0;'>
            <h2>Funcionalidades del Módulo</h2>
            <ul>
                <li>Registrar nuevas ventas (boletas/facturas)</li>
                <li>Gestión de clientes</li>
                <li>Emisión de comprobantes electrónicos SUNAT</li>
                <li>Control de stock antes de venta</li>
                <li>Registro de pagos</li>
                <li>Reportes de ventas</li>
                <li>Edición y anulación de ventas</li>
                <li>Integración contable</li>
                <li>Seguridad y auditoría</li>
            </ul>
        </div>
        <script>renderVentas();renderVentasHoy();<\/script>
        `;
        setTimeout(() => { renderVentas(); renderVentasHoy(); }, 0);
    }

    function getStock(prod, talla, color) {
        const item = almacen.find(a => a.producto === prod && a.talla === talla && a.color === color);
        return item ? item.stock : 0;
    }
    function getImagen(prod, talla, color) {
        const item = almacen.find(a => a.producto === prod && a.talla === talla && a.color === color);
        return item ? item.imagen : '';
    }

    function renderVentas() {
        const body = document.getElementById('ventasBody');
        body.innerHTML = ventas.map((v,i) => {
            const stock = getStock(v.producto, v.talla, v.color);
            const img = getImagen(v.producto, v.talla, v.color);
            const fechaStr = v.fecha ? `${v.fecha.toLocaleDateString()} ${v.fecha.toLocaleTimeString()}` : '-';
            return `<tr>
                <td>${v.id}</td>
                <td>${v.cliente}</td>
                <td>${v.producto}</td>
                <td>${img ? `<img src='${img}' class='img-thumb' alt='${v.producto}'>` : '-'}</td>
                <td>${v.talla}</td>
                <td>${v.color}</td>
                <td>${v.cantidad}</td>
                <td class='stock-info'>${stock} unidades</td>
                <td class='actions'><button onclick='editVenta(${i})'>Editar</button><button onclick='delVenta(${i})'>Eliminar</button></td>
            </tr>
            <tr style='background:#f9f9f9;'><td colspan='9' style='font-size:0.95em;'>Fecha: ${fechaStr} &nbsp;|&nbsp; Total: S/ ${v.total ? v.total.toFixed(2) : '-'} &nbsp;|&nbsp; Pagado: S/ ${v.pagado ? v.pagado.toFixed(2) : '-'} &nbsp;|&nbsp; Vuelto: S/ ${v.vuelto ? v.vuelto.toFixed(2) : '-'}</td></tr>`;
        }).join('');
    }

    function renderVentasHoy() {
        const hoy = new Date();
        const ventasHoy = ventas.filter(v => {
            if (!v.fecha) return false;
            return v.fecha.getDate() === hoy.getDate() && v.fecha.getMonth() === hoy.getMonth() && v.fecha.getFullYear() === hoy.getFullYear();
        });
        const body = document.getElementById('ventasHoyBody');
        body.innerHTML = ventasHoy.map((v,i) => {
            const stock = getStock(v.producto, v.talla, v.color);
            const img = getImagen(v.producto, v.talla, v.color);
            const fechaStr = v.fecha ? `${v.fecha.toLocaleDateString()} ${v.fecha.toLocaleTimeString()}` : '-';
            const editInfo = v.editado ? `<br><span style='color:#e67e22;'>Editado: ${v.editado.fecha} (${v.editado.cambios})</span>` : '';
            return `<tr>
                <td>${v.id}</td>
                <td>${v.cliente}</td>
                <td>${v.producto}</td>
                <td>${img ? `<img src='${img}' class='img-thumb' alt='${v.producto}'>` : '-'}</td>
                <td>${v.talla}</td>
                <td>${v.color}</td>
                <td>${v.cantidad}</td>
                <td class='stock-info'>${stock} unidades</td>
                <td class='actions'><button onclick='editVentaHoy(${i})'>Editar</button></td>
            </tr>
            <tr style='background:#f9f9f9;'><td colspan='9' style='font-size:0.95em;'>Fecha: ${fechaStr} &nbsp;|&nbsp; Total: S/ ${v.total ? v.total.toFixed(2) : '-'} &nbsp;|&nbsp; Pagado: S/ ${v.pagado ? v.pagado.toFixed(2) : '-'} &nbsp;|&nbsp; Vuelto: S/ ${v.vuelto ? v.vuelto.toFixed(2) : '-'}</td></tr>`;
        }).join('');
    }

    function addVenta() {
        const id = ventas.length+1;
        const cliente = prompt('Cliente:', 'Nuevo Cliente') || 'Nuevo Cliente';
        const producto = prompt('Producto:', 'Media nueva') || 'Media nueva';
        const talla = prompt('Talla:', 'M') || 'M';
        const color = prompt('Color:', 'Negro') || 'Negro';
        const cantidad = parseInt(prompt('Cantidad:', '1')) || 1;
        let precioUnitario = 5; // Simulación
        const total = cantidad * precioUnitario;
        const pagado = parseFloat(prompt(`Total a pagar: S/ ${total}\n¿Con cuánto paga el cliente?`, total)) || total;
        const vuelto = pagado - total;
        alert(`Vuelto a entregar: S/ ${vuelto.toFixed(2)}`);
        const fecha = new Date();
        ventas.push({id, cliente, producto, talla, color, cantidad, total, pagado, vuelto, fecha});
        renderVentas();
    }
    function editVenta(i) {
        ventas[i].cliente = prompt('Cliente:', ventas[i].cliente) || ventas[i].cliente;
        ventas[i].producto = prompt('Producto:', ventas[i].producto) || ventas[i].producto;
        ventas[i].talla = prompt('Talla:', ventas[i].talla) || ventas[i].talla;
        ventas[i].color = prompt('Color:', ventas[i].color) || ventas[i].color;
        ventas[i].cantidad = parseInt(prompt('Cantidad:', ventas[i].cantidad)) || ventas[i].cantidad;
        renderVentas();
    }
    function delVenta(i) {
        if(confirm('¿Eliminar venta?')) { ventas.splice(i,1); renderVentas(); }
    }
    function editVentaHoy(i) {
        // Solo editar ventas del día
        const hoy = new Date();
        const ventasHoy = ventas.filter(v => {
            if (!v.fecha) return false;
            return v.fecha.getDate() === hoy.getDate() && v.fecha.getMonth() === hoy.getMonth() && v.fecha.getFullYear() === hoy.getFullYear();
        });
        const v = ventasHoy[i];
        let cambios = [];
        let nuevoProducto = prompt('Producto:', v.producto);
        if(nuevoProducto && nuevoProducto !== v.producto) { cambios.push('Producto'); v.producto = nuevoProducto; }
        let nuevaCantidad = parseInt(prompt('Cantidad:', v.cantidad));
        if(!isNaN(nuevaCantidad) && nuevaCantidad !== v.cantidad) { cambios.push('Cantidad'); v.cantidad = nuevaCantidad; }
        let nuevoTotal = parseFloat(prompt('Total:', v.total));
        if(!isNaN(nuevoTotal) && nuevoTotal !== v.total) { cambios.push('Total'); v.total = nuevoTotal; }
        let nuevoPagado = parseFloat(prompt('Pagado:', v.pagado));
        if(!isNaN(nuevoPagado) && nuevoPagado !== v.pagado) { cambios.push('Pagado'); v.pagado = nuevoPagado; }
        let nuevoVuelto = nuevoPagado - nuevoTotal;
        if(nuevoVuelto !== v.vuelto) { cambios.push('Vuelto'); v.vuelto = nuevoVuelto; }
        if(cambios.length > 0) {
            v.editado = {
                fecha: new Date().toLocaleString(),
                cambios: cambios.join(', ')
            };
        }
        renderVentasHoy();
        renderVentas();
    }

    // Inicializar
    showLogin();
    </script>
</body>
</html>
